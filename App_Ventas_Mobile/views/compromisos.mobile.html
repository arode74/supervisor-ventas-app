<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Compromisos ‚Äî M√≥vil</title>

  <!-- Mantener rutas relativas consistentes desde /views/ -->
  <link rel="stylesheet" href="../styles/mobile-afp.css"/>
  <link rel="stylesheet" href="../styles/mobile.css"/>

  <script src="../env.js"></script>
  <script>
    try {
      if (typeof window.SUPABASE_URL === "undefined" && typeof SUPABASE_URL !== "undefined") window.SUPABASE_URL = SUPABASE_URL;
      if (typeof window.SUPABASE_ANON_KEY === "undefined" && typeof SUPABASE_ANON_KEY !== "undefined") window.SUPABASE_ANON_KEY = SUPABASE_ANON_KEY;
    } catch (e) {}
  </script>

  <style>
    /* Ajustes m√≠nimos, encapsulados para esta vista */
    .cmp-row { display:flex; gap:10px; align-items:center; }
    .cmp-row > * { flex:1; }
    .cmp-week { font-size:12px; opacity:.85; padding:8px 10px; border:1px solid rgba(0,0,0,.1); border-radius:10px; }
    .cmp-card { border:1px solid rgba(0,0,0,.12); border-radius:14px; padding:12px; margin:10px 0; background:#fff; }
    .cmp-card-top { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .cmp-name { font-weight:700; font-size:16px; }
    .cmp-kpi { font-weight:700; font-size:14px; white-space:nowrap; }
    .cmp-sub { font-size:12px; opacity:.85; margin-top:6px; }
    .cmp-bar { height:6px; border-radius:999px; background:rgba(0,0,0,.08); overflow:hidden; margin-top:10px; }
    .cmp-bar > div { height:100%; width:0%; background:#1f6feb; }
    .cmp-btn { border:0; border-radius:10px; padding:8px 12px; font-weight:700; cursor:pointer; background:#1f6feb; color:#fff; }
    .cmp-btn:disabled { opacity:.6; cursor:not-allowed; }
    .cmp-sheet-grid { display:grid; grid-template-columns: 1fr 110px; gap:10px; align-items:center; }
    .cmp-input { width:100%; padding:10px; border:1px solid rgba(0,0,0,.16); border-radius:10px; font-size:14px; }
    .cmp-hint { font-size:12px; opacity:.75; }
    .cmp-tabs { display:flex; gap:8px; margin:10px 0 6px; }
    .cmp-tab { flex:1; padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,.16); background:#fff; font-weight:800; cursor:pointer; }
    .cmp-tab.is-active { background:#1f6feb; color:#fff; border-color:#1f6feb; }
    .cmp-sheet { position:fixed; inset:0; display:none; z-index:50; }
    .cmp-sheet.is-open { display:block; }
    .cmp-sheet .bd { position:absolute; inset:0; background:rgba(0,0,0,.35); }
    .cmp-sheet .pn { position:absolute; left:0; right:0; bottom:0; background:#fff; border-top-left-radius:18px; border-top-right-radius:18px; padding:14px; max-height:80vh; overflow:auto; }
    .cmp-sheet .hd { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .cmp-sheet .ttl { font-weight:900; font-size:16px; }
    .cmp-x { border:0; background:transparent; font-size:18px; cursor:pointer; }
    .cmp-actions { display:flex; gap:10px; margin-top:12px; }
    .cmp-actions button { flex:1; padding:12px; border-radius:12px; font-weight:900; border:1px solid rgba(0,0,0,.16); background:#fff; cursor:pointer; }
    .cmp-actions .primary { background:#1f6feb; color:#fff; border-color:#1f6feb; }
  </style>
</head>

<body>
  <div class="ventas-screen">

    <header class="m-topbar">
      <img class="m-topbar__logo" src="../assets/logo_app_ventas.png" alt="APP Ventas"/>
      <div class="m-topbar__title">Compromisos</div>
      <button class="m-topbar__logout" id="btnSalir" type="button" aria-label="Cerrar sesi√≥n" title="Cerrar sesi√≥n">‚èª</button>
    </header>

    <div class="ventas-top">
      <div class="m-toolbar">
        <div class="m-field">
          <div class="m-field__icon">üìÖ</div>
          <input class="m-input" id="dtDia" type="date"/>
        </div>

        <div class="m-toolbar__right">
          <button class="m-backbtn" type="button" id="btnVolver">‚Äπ Volver</button>
        </div>
      </div>

      <div class="cmp-row" style="margin-top:10px;">
        <div class="cmp-week" id="lblSemana">Semana: ‚Äî</div>
        <div class="m-field" style="margin:0;">
          <div class="m-field__icon">üë•</div>
          <input class="m-input" id="txtEquipo" type="text" value="" readonly/>
        </div>
      </div>

      <div class="m-field m-gap-10">
        <div class="m-field__icon">üîé</div>
        <input class="m-input" id="txtBuscar" type="search" placeholder="Buscar vendedor‚Ä¶" autocomplete="off"/>
      </div>
    </div>

    <main class="ventas-scroll">
      <section class="ventas-layout">
        <section class="m-card ventas-lista" aria-label="Lista de vendedores">
          <div id="listaVendedores">
            <!-- Render din√°mico por JS -->
          </div>
        </section>
      </section>
    </main>

    <!-- Bottom sheet -->
    <div id="sheet" class="cmp-sheet" aria-hidden="true">
      <div class="bd" data-close></div>
      <div class="pn" role="dialog" aria-modal="true" aria-label="Editar compromiso">
        <div class="hd">
          <div class="ttl" id="sheetTitulo">Editar Compromiso</div>
          <button class="cmp-x" type="button" data-close aria-label="Cerrar">‚úï</button>
        </div>

        <div class="cmp-hint" id="sheetSub">‚Äî</div>

        <div class="cmp-tabs">
          <button class="cmp-tab is-active" id="tabSemanal" type="button">Semanal</button>
          <button class="cmp-tab" id="tabMensual" type="button">Mensual</button>
        </div>

        <div id="sheetContenido"></div>

        <div class="cmp-actions">
          <button type="button" id="btnCancelar">Cancelar</button>
          <button type="button" class="primary" id="btnGuardar">Guardar</button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../scripts/mobile_shared.js"></script>
    <script src="../scripts/compromisos.mobile.js"></script>

  </div>
</body>
</html>
